<!DOCTYPE html><html><head>
      <title>SAD - U4.3. Proxy</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,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") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      <div>
<h1 id="sad---u42-seguridad-en-aplicaciones">SAD - U4.2. Seguridad en aplicaciones </h1>
<p><a href="./U4_3_Proxy.pdf">Descargar estos apuntes</a></p>
<h2 id="índice">Índice </h2>

<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-proxy-con-squid" class="md-toc-link"><ol start="2">
<li>Proxy con Squid</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-instalación-y-configuración-de-squid" class="md-toc-link">
            <p>2.1. Instalación y configuración de Squid</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#22-condiciones-de-las-reglas-acl-access-control-list-en-squid" class="md-toc-link">
            <p>2.2. Condiciones de las reglas ACL (Access control list) en SQUID</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#23-reglas-de-control-de-acceso-acceso-a-http" class="md-toc-link">
            <p>2.3. Reglas de control de acceso (acceso a http)</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#24-tipos-de-acl" class="md-toc-link"><p>2.4 Tipos de ACL</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ips-origen-i-destino" class="md-toc-link">
            <p>IP’s origen i destino</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dominios-de-origen-y-destino" class="md-toc-link">
            <p>Dominios de origen y destino</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#horarios" class="md-toc-link">
            <p>Horarios</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#expresiones-regulares-en-la-url-y-el-path" class="md-toc-link">
            <p>Expresiones regulares en la URL y el PATH</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#otros-tipos-de-acl" class="md-toc-link">
            <p>Otros tipos de ACL</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#25-ejemplos-de-configuración-de-squid" class="md-toc-link"><p>2.5. Ejemplos de configuración de Squid</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejemplo-1" class="md-toc-link">
            <p>Ejemplo 1</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejemplo-2-de-uso-de-acls-y-http_access" class="md-toc-link">
            <p>Ejemplo 2 de uso de acl’s y http_access</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejemplo-completo-caso-concreto" class="md-toc-link">
            <p>Ejemplo completo: caso concreto</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
</div>
<div style="\&quot;page-break-after:always;\&quot;"></div>
<h2 id="1-qué-es-un-servidor-proxy">1. ¿Qué es un servidor proxy? </h2>
<p>Es un <strong>agente intermediario</strong> que realiza una acción en representación de otro. Intercepta las conexiones de red hechas desde un cliente a un servidor de destino.</p>
<ul>
<li><strong>Funcionamiento</strong>: A solicita un recurso de C mediante B</li>
</ul>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-d503d8f3.png" alt="Servidor proxy"></p>
<p><a href="https://www.ionos.es/digitalguide/servidores/know-how/que-es-un-servidor-proxy-inverso/">https://www.ionos.es/digitalguide/servidores/know-how/que-es-un-servidor-proxy-inverso/</a>.</p>
<h3 id="11-proxy-como-firewall-de-nivel-de-aplicación">1.1. Proxy como firewall de nivel de aplicación </h3>
<p>Los servidores proxy actúan sobre la <strong>capa de aplicación (nivel 7)</strong> del modelo OSI.</p>
<ul>
<li>Puede entender ciertas aplicaciones y protocolos de nivel 7 (por ejemplo, protocolo de transferencia de archivos o <strong>FTP</strong>, <strong>DNS</strong> o <strong>HTTP</strong>).</li>
<li><strong>Permite detectar si un protocolo no deseado está funcionando por un puerto no estándar</strong> o si se abusa de un protocolo de forma perjudicial, gracias a que entiende los protocolos de nivel de aplicación.</li>
<li>Es mucho <strong>más seguro y fiable</strong> comparado con cortafuegos de filtrado de paquetes, ya que repercute sobre las 7 capas del modelo OSI.</li>
<li>Es similar a un cortafuegos de filtrado de paquetes, pero también permite <strong>filtrar por el contenido del paquete</strong>, por ejemplo, para encontrar un archivo de malware en una respuesta http.</li>
</ul>
<h3 id="12-ventajas">1.2 Ventajas </h3>
<h4 id="mejora-la-seguridad">Mejora la seguridad </h4>
<ul>
<li>
<p>Puede <strong>bloquear tráfico malicioso</strong>, ya que analiza el contenido del paquete, por ejemplo, las peticiones HTTP, para observar si se hace la descarga de un archivo ejecutable.</p>
</li>
<li>
<p><strong>Bloquea</strong> el acceso a sitios no deseados, por ejemplo, examinando la URL de destino.</p>
</li>
<li>
<p>Puede hacer <strong>Filtrado de contenidos/Control de contenidos</strong> que no queremos que los usuarios accedan, como por ejemplo, contenido</p>
</li>
<li>
<p><strong>Restringe el acceso a Internet</strong> para solo unos determinados puertos (el resto quedarán cerrados).</p>
</li>
<li>
<p><strong>Oculta la identidad</strong> y da privacidad de los equipos de la red interna a nivel de red (solo un equipo se comunica con Internet).</p>
<ul>
<li>Puede dar servicio a muchos usuarios para solicitar a través de él contenidos web (Ocultación IP / anonimato).</li>
<li>La petición del host NO va destinada al servidor final si no que se hace a la IP del proxy. Este será el que hará la petición a Internet.</li>
<li>Tampoco hay enrutamiento ni acceso directo como en el caso del firewall de nivel 3 y 4.</li>
</ul>
</li>
</ul>
<h4 id="acelera-la-navegación-por-internet">Acelera la navegación por Internet </h4>
<ul>
<li>Los usuarios de la red local navegan más rápido, ya que puede guardar en <strong>memoria caché</strong> los recursos que se han descargado previamente de Internet.</li>
<li>Utilización más eficiente de la conexión a Internet.</li>
<li>Aumento y mejora de la velocidad de respuesta a peticiones.</li>
</ul>
<h4 id="registra-la-actividad-de-la-red">Registra la actividad de la red </h4>
<p>Se guarda en los logs la actividad hacia Internet u otras redes. Así podemos extraer estadísticas de uso del acceso a Internet, y tomar decisiones basadas en datos, por ejemplo:</p>
<ul>
<li>Saber qué sitios son más visitados, así guardar en caché todo lo que se pueda</li>
<li>Saber qué sitios se visitan y no se quiere permitir</li>
<li>Saber cuál es el periodo que se utiliza más el acceso a Internet</li>
<li>Saber el ancho de banda usado por cada usuario y si hay abuso...</li>
</ul>
<h3 id="13-inconvenientes">1.3 Inconvenientes </h3>
<h4 id="posibles-contenidos-desactualizados">Posibles contenidos desactualizados </h4>
<ul>
<li><strong>Puede servir a los clientes contenidos desactualizados de la memoria caché</strong>. Esto se mejora comprobando la fecha de caducidad de los recursos en la memoria caché.</li>
</ul>
<h4 id="puede-impedir-la-realización-de-operaciones-de-red-avanzadas">Puede impedir la realización de operaciones de red avanzadas </h4>
<ul>
<li>Algunos protocolos no soportan el uso de proxy, por ejemplo el protocolo SIP de VoIP.</li>
</ul>
<h4 id="posible-violación-de-la-intimidad">Posible violación de la intimidad </h4>
<p>El proxy actúa como un "man-in-the-middle" de los usuarios de la red local.</p>
<ul>
<li>Almacenar las páginas y objetos que los usuarios solicitan puede suponer una <strong>violación de la intimidad</strong> para algunas personas.</li>
<li>Hay que establecer en las políticas de la empresa que se está monitorizando el tráfico de los usuarios.</li>
</ul>
<h4 id="posible-punto-de-congestión">Posible punto de congestión </h4>
<p>Como tiene que gestionar mucho tráfico de red hacia el exterior, esto puede hacer que en determinados momentos sea un cuello de botella.</p>
<ul>
<li>Entonces, hay que dimensionar bien este equipo en memoria RAM y disco.</li>
<li>Utilizar el balanceo de carga, que sería un clúster de servidores proxy repartiéndose el trabajo.</li>
</ul>
<h2 id="14-tipos-de-servidores-proxy">1.4. Tipos de servidores proxy </h2>
<p>Podemos clasificar los tipos de proxy según su función en:</p>
<h3 id="1-proxy-cache-y-proxy-nat">1. Proxy cache y proxy NAT </h3>
<ul>
<li><strong>Proxy cache</strong> web: Aplicación específica de acceso a la web, para mejorar su rendimiento. Mantienen copias locales de los archivos más solicitados.</li>
<li><strong>Proxy NAT</strong>: Integra los servicios de traducción de direcciones de red privada-pública en el Proxy.</li>
</ul>
<h3 id="proxy-transparente">Proxy transparente </h3>
<p>Es un proxy normal, no es necesario configurar las aplicaciones clientes, como el navegador web, cliente ftp, cliente de correo, etc. para indicar que deben interactuar con un servidor proxy (dirección proxy), ya que las peticiones siempre van destinadas al proxy.</p>
<p>Pero el proxy transparente combina un <strong>servidor proxy</strong> con un <strong>enrutador</strong> o firewall. Por simplicidad se puede hacer que se ejecuten en la misma máquina.</p>
<hr>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-e3ede78a.png" alt="Configuración de proxy transparente con dos dispositivos"></p>
<ol>
<li>Los clientes envían las peticiones a los servidores de destino originales, por ejemplo Google, teniendo como gateway el enrutador-firewall que trabaja en conjunto con el proxy.</li>
<li>El enrutador-firewall reenvía las conexiones de los clientes destinadas al puerto 80 hacia el puerto del servicio proxy (3128 habitualmente).</li>
<li>El proxy filtra la petición, tal como esté definido en sus políticas, y reenvía la petición si es necesario hacia el enrutador-firewall para que la reenvíe a Internet.</li>
</ol>
<p>Esto elimina la necesidad de configurar los clientes para ir a través de proxy.</p>
<ul>
<li>Las aplicaciones NO son conscientes de tener un proxy por el medio y por eso se llama transparente (como un vidrio que permite ver Internet a través de él).</li>
<li>Este tipo de proxy no permite hacer autenticación de usuarios como hacen los proxys convencionales.</li>
</ul>
<p>Squid también lo permite</p>
<h3 id="proxy-anónimo">Proxy anónimo </h3>
<p>Es un proxy público que aumenta la privacidad y el anonimato de los clientes proxy mediante la eliminación de características identificativas.</p>
<ul>
<li>De hecho, como las peticiones reales parten del proxy, es su dirección IP de origen la que aparece en los paquetes de tráfico.</li>
<li>Los servidores web a los que se accede no pueden ver la dirección IP real del cliente, sino la del proxy.</li>
</ul>
<h3 id="proxy-inverso-reverse-proxy">Proxy inverso (reverse proxy) </h3>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-73506b7e.png" alt="Proxy inverso"><br>
<a href="https://www.ionos.es/digitalguide/servidores/know-how/que-es-un-servidor-proxy-inverso/">https://www.ionos.es/digitalguide/servidores/know-how/que-es-un-servidor-proxy-inverso/</a></p>
<p>El proxy inverso <strong>se sitúa en la red de destino</strong>, donde se encuentran los servidores, y no en la red origen, donde están los clientes, como los proxy-caché.</p>
<p>El proxy inverso es un proxy instalado en una red con diferentes servidores web (o de otros tipos), sirviendo de intermediario a las peticiones externas.</p>
<ul>
<li><strong>Da "servicio" a servidores</strong> web, de bases de datos, etc. y <strong>no a los clientes</strong>.</li>
<li>Mejora la seguridad de los servidores que tiene detrás, ya que recibe todas las peticiones y las gestiona.</li>
<li>Mejora el rendimiento ya que <strong>hace de servidor de balanceo de carga</strong>, repartiendo las peticiones entre los servidores que tiene detrás.</li>
<li>También <strong>guarda en memoria caché el contenido estático</strong>, por ejemplo archivos html de los servidores que tiene detrás.</li>
</ul>
<p>Ejemplos pueden ser <strong>HA Proxy, NGINX, Traefik</strong>.</p>
<p><a href="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-0e2d7de0.png">Exemple de configuració de NGINX com a proxy invers</a></p>
<h3 id="proxy-abierto-o-público">Proxy abierto o público </h3>
<p>Este proxy acepta peticiones de cualquier ordenador, esté o no conectado a su red. Suelen situarse en Internet como proxy público.</p>
<p>Es un servidor proxy público, susceptible de abuso pero también puede ser usado por espías.</p>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-ea27dd33.png" alt="proxy público"></p>
<h2 id="15-posible-ubicación-del-proxy">1.5. Posible ubicación del proxy </h2>
<h3 id="no-intercepción">No intercepción </h3>
<p>En este caso, el proxy es un equipo más de la red local.</p>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-c91c89f7.png" alt=""></p>
<p>Medidas adicionales:</p>
<ul>
<li>Hay que configurar los equipos para que utilicen el proxy (en la aplicación cliente web) pero los usuarios con conocimientos podrían “saltarse” el proxy.</li>
<li>Hay que configurar el firewall para que sólo acepte tráfico proveniente del proxy y no de los clientes de la red local.</li>
<li>Alguien podría suplantar la IP del proxy si se encuentra en la misma red.</li>
</ul>
<h3 id="intercepción">Intercepción </h3>
<p>El proxy es un equipo que intercepta físicamente las conexiones de red (está en medio), y está dotado de dos interfaces de red.</p>
<p><img src="https://gitlab.com/pautome/m11-asix-pub-24-25/-/raw/main/UF3-Firewall-Proxy/_APUNTS/3.proxy/imgs/proxy-df441f9c.png" alt=""></p>
<ul>
<li>En este caso, si cae el proxy, quedamos sin conexión a internet y habríamos de tener soluciones alternativas.</li>
</ul>
<h1 id="2-proxy-con-squid">2. Proxy con Squid </h1>
<p>Squid <a href="http://www.squid-cache.org/">http://www.squid-cache.org/</a> es un popular programa libre que implementa un servidor proxy y memoria caché de páginas web, con licencia GPL.</p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Permite acelerar un servidor web, guardar en memoria caché peticiones repetidas a DNS y otras búsquedas, memoria caché de web y seguridad filtrando el tráfico.</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Está diseñado para ejecutarse bajo entornos Unix (pero funciona con Windows).</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Se le considera muy completo y robusto.</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Orientado a HTTP y FTP pero compatible con otros protocolos.</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Implementa diversas modalidades de cifrado como TLS, SSL, y HTTPS.</li>
</ul>
<h3 id="características-de-squid">Características de Squid </h3>
<p>Algunas de sus características son:</p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Proxy y Memoria caché HTTP, FTP, HTTPS.</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Proxy para SSL</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Proxy transparente</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Soporta WCCP (Web Cache Control Protocol), control de múltiples proxys para balancear carga.</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Reglas de Control de acceso</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked=""> Aceleración de navegación HTTP.</li>
</ul>
<h2 id="21-instalación-y-configuración-de-squid">2.1. Instalación y configuración de Squid </h2>
<p>Para instalar Squid en Ubuntu, ejecutamos:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> squid
</code></pre><p>Para comprobar que Squid está en ejecución, ejecutamos:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> systemctl status squid
<span class="token comment"># o bien</span>
<span class="token function">sudo</span> <span class="token function">service</span> squid status
</code></pre><p>También podemos comprobar que Squid está escuchando en el puerto 3128 con:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">netstat</span> <span class="token parameter variable">-tuln</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">3128</span>
</code></pre><p>Y por último, podemos ver los losg de squid en <code>/var/log/squid/access.log</code> y <code>/var/log/squid/cache.log</code>.</p>
<p>Una vez instalado, podemos configurar Squid editando el archivo de configuración <code>/etc/squid/squid.conf</code>.</p>
<p>Este fichero está dividido en secciones, de las cuales, las más importantes son:</p>
<ul>
<li><strong>OPTiONS FOR AUTHENTICATION</strong>: Para configurar la validación de usuarios. Vàries directives "auth...".</li>
<li><strong>ACCESS CONTROLS</strong>: Directivas "acl" y "http_access".</li>
<li><strong>NETWORK OPTIONS</strong>: Directiva "http_port".</li>
<li><strong>OPTIONS WHICH AFFECT THE NEIGHBOR SELECTION ALGORITHM</strong>: Directiva "cache_peer"</li>
<li><strong>MEMORY CACHE OPTIONS</strong>: "cache_mem",  "maximum_object_size_in_memory",</li>
<li><strong>DISK CACHE OPTIONS:</strong> "cache_dir", "minimum_object_size", "maximum_object_size"</li>
<li><strong>OPTIONS FOR URL REWRITING</strong>: "url_rewrite_program", "url_rewrite_children", "url_rewrite_access"</li>
</ul>
<p>Algunas de las directivas más importantes de Squid son:</p>
<ul>
<li><strong>http_port</strong>: Define el puerto en el que Squid escucha las peticiones HTTP.</li>
<li><strong>cache_dir</strong>: Define el directorio de la memoria caché de Squid.</li>
<li><strong>cache_mem</strong>: Define la cantidad de memoria caché de Squid.</li>
<li><strong>acl</strong>: Define las listas de control de acceso de Squid.</li>
<li><strong>http_access</strong>: Define las reglas de acceso de Squid.</li>
<li><strong>http_reply_access</strong>: Define las reglas de respuesta de Squid.</li>
<li><strong>cache_peer</strong>: Define los servidores de memoria caché de Squid.</li>
<li><strong>never_direct</strong>: Define las excepciones de memoria caché de Squid.</li>
<li><strong>refresh_pattern</strong>: Define las reglas de actualización de la memoria caché de Squid.</li>
<li><strong>visible_hostname</strong>: Define el nombre visible de Squid.</li>
<li><strong>logformat</strong>: Define el formato de los logs de Squid.</li>
<li><strong>access_log</strong>: Define el archivo de logs de Squid.</li>
<li><strong>cache_log</strong>: Define el archivo de logs de la memoria caché de Squid.</li>
</ul>
<p>Antes de aplicar los cambios realizados en el archivo de configuración de Squid, es recomendable comprobar que la configuración es correcta con:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> squid <span class="token parameter variable">-k</span> reconfigure
<span class="token comment"># o bien</span>
<span class="token function">sudo</span> <span class="token function">service</span> <span class="token parameter variable">-k</span> parse
</code></pre><p>Para aplicar los cambios en la configuración de Squid, reiniciamos el servicio con:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> systemctl restart squid
<span class="token comment"># o bien</span>
<span class="token function">sudo</span> <span class="token function">service</span> squid reload
</code></pre><h2 id="22-condiciones-de-las-reglas-acl-access-control-list-en-squid">2.2. Condiciones de las reglas ACL (Access control list) en SQUID </h2>
<p>Primero se definen las condiciones a comprobar para cada petición de los clientes. Se hace con la directiva acl.</p>
<blockquote>
<p>acl [nombre de la lista] [tipo] [componentes de la lista]</p>
</blockquote>
<p>Las condiciones definidas se usan después en las reglas de control como <strong>"http_access"</strong>. El orden en que definimos las condiciones "acl" <strong>no tiene importancia</strong>.</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl localnet src <span class="token number">172.16</span>,100.0/28
acl hosts_permesos src <span class="token parameter variable">-i</span> <span class="token string">"/etc/squid/listas/permitidos"</span>
acl hosts_profes <span class="token number">192.168</span>.0.4 <span class="token number">192.168</span>.0.7
acl sites_prohibits url_regex facebook.com twitter.com
</code></pre><p><em>El parámetro -i permite ignorar mayúsculas y minúsculas.</em></p>
<p>Si la lista de parámetros es muy grande, es preferible usar un fichero para poner los parámetros (uno por cada línea). Habrá que poner el nombre de fichero con la ruta entre comillas.</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl hosts_permitidos src <span class="token parameter variable">-i</span> <span class="token string">"/etc/squid/listas/permitidos"</span>
</code></pre><p>En el fichero permisos habría una lista de ip’s, una por cada línea, con los hosts permitidos:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token number">92.168</span>.0.25
<span class="token number">192.168</span>.0.35
<span class="token number">192.168</span>.0.70
</code></pre><div class="admonition warning">
<p class="admonition-title">Ficheros de ACL</p>
<p>Nos debemos asegurar que el fichero existe en la ruta indicada y que el usuario "proxy" lo puede leer.</p>
</div>
<h2 id="23-reglas-de-control-de-acceso-acceso-a-http">2.3. Reglas de control de acceso (acceso a http) </h2>
<p>Después se definen las acciones (deny/allow) que se debe ejecutar con la petición del cliente si la/las condición/es que ponemos como parámetros se cumplen.</p>
<blockquote>
<p>http_access [deny o allow] [acl implicadas]</p>
</blockquote>
<div class="admonition warning">
<p class="admonition-title">Orden de las reglas</p>
<p>El orden en que escribimos las HTTP_ACCESS es <strong>MUY importante</strong>. No se pueden escribir en cualquier orden (similar a las reglas iptables). Normalmente haremos:</p>
<ul>
<li>Primero pondremos las reglas más específicas (afectan a menos hosts)</li>
<li>Después las menos específicas (afectan a más hosts).</li>
</ul>
<p>Esto no quiere decir que no haya casos en que se deba hacer de otra manera.</p>
</div>
<p><strong>Ejemplo1</strong>: Regla genérica (afecta a muchos hosts). La segunda regla se tiene que poner siempre como política por defecto que afecta a todos los hosts, y cambiar el orden hará que nadie pueda navegar por Internet.</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>http_access allow hosts_permitidos
http_access deny all
</code></pre><p><strong>Ejemplo2</strong>: Regla más específica, tiene dos condiciones definidas antes en las "acl". Afecta a las mismas IP's origen que antes pero ahora sólo a las peticiones que NO van destinadas a hosts prohibidos. Se tienen que cumplir las dos condiciones (AND). Sólo con que falle una, no se ejecuta la regla (que en este caso es allow).</p>
<ul>
<li>Si la regla se ejecuta, no se mira ninguna regla más (como en iptables).</li>
<li>Se puede negar una acl con el símbolo !</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>// Si la IP es de un <span class="token function">host</span> permitido <span class="token punctuation">(</span>AND<span class="token punctuation">)</span> la URL NO contiene una palabra prohibida
http_access allow hosts_permitidos <span class="token operator">!</span>sites_prohibidos
http_access deny all
</code></pre><ul>
<li>Si se quiere hacer un "OR lógico" (o sea, una condición o la otra) se tiene que duplicar la regla (en el ejemplo, tres acl de tipo src):</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>http_access allow red_profesores
http_access allow red_alumnos
</code></pre><ul>
<li>Si se quiere hacer AND (las dos acl se cumplen) se ponen una al lado de la otra.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>http_access allow red_alumnos red_profesores
</code></pre><p><strong>ATENCIÓN</strong>: Esta última regla es imposible que se cumpla nunca ya que las dos redes son diferentes y un paquete sólo puede tener ip origen en una de las dos.</p>
<h2 id="24-tipos-de-acl">2.4 Tipos de ACL </h2>
<h3 id="ips-origen-i-destino">IP’s origen i destino </h3>
<p>Para mirar direcciones IP de origen o destino (src, dst).</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl aclname src ip-address/netmask <span class="token punctuation">..</span>.  <span class="token comment"># Dirección IP del cliente (src=source=origen)</span>
acl aclname src addr1-addr2/netmask <span class="token punctuation">..</span>. <span class="token comment"># Igual pero con un rango de direcciones</span>
acl aclname dst ip-address/netmask <span class="token punctuation">..</span>.    <span class="token comment"># Dirección IP obtenida de la URL de destino (dst=destino)</span>
</code></pre><p>Ejemplos:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl pc-jefe src <span class="token number">192.168</span>.0.22
acl pcs-alumnos src <span class="token number">192.168</span>.0.50-192.168.0.60
acl ip-facebook dst <span class="token number">157.240</span>.243.35
acl red-prohibida dst <span class="token number">192.168</span>.10.0/24
</code></pre><h3 id="dominios-de-origen-y-destino">Dominios de origen y destino </h3>
<p>Para mirar dominios de origen o destino (srcdomain, dstdomain).</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl aclname srcdomain .foo.com <span class="token punctuation">..</span>.          <span class="token comment"># Dominio origen de la petición</span>
acl aclname dstdomain .foo.com <span class="token punctuation">..</span>.          <span class="token comment"># Dominio de destino</span>
</code></pre><h3 id="horarios">Horarios </h3>
<p>Para comprobar un horario:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl aclname <span class="token function">time</span> <span class="token punctuation">[</span>day-abbrevs<span class="token punctuation">]</span> <span class="token punctuation">[</span>h1:m1-h2:m2<span class="token punctuation">]</span>   <span class="token comment"># Días y hora a comprobar</span>
</code></pre><p>Abreviaturas:<br>
S - Sunday, M - Monday, T - Tuesday, W - Wednesday H - Thursday, F - Friday, A - Saturday<br>
h1:m1 ha de ser menor que h2:m2</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl horari_laboral_mati <span class="token function">time</span> MTWHF 09:00-14:30
</code></pre><h3 id="expresiones-regulares-en-la-url-y-el-path">Expresiones regulares en la URL y el PATH </h3>
<p>Para buscar una expresión dentro de la URL:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl aclname url_regex <span class="token punctuation">[</span>-i<span class="token punctuation">]</span> ^http:// <span class="token punctuation">..</span>.   <span class="token comment"># Expresión regular que se busca dentro de la URL completa</span>
acl aclname urlpath_regex <span class="token punctuation">[</span>-i<span class="token punctuation">]</span> <span class="token punctuation">\</span>.gif$ <span class="token punctuation">..</span>. <span class="token comment"># Expresión regular que se busca sólo dentro del camino de la URL</span>
</code></pre><p>Para más información de las expresiones regulares (RegEx) y prueba: <a href="https://regexr.com/">https://regexr.com/</a></p>
<p>Ejemplos</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>// Al principio de la URL, buscar la cadena seguida de cualquier carácter
acl aclname url_regex serv_publicidad ^http://adserver.*

// Buscar al final de la URL las letras mp3
acl aclname url_regex ficheros_mp3 <span class="token parameter variable">-i</span> mp3$
</code></pre><h3 id="otros-tipos-de-acl">Otros tipos de ACL </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl aclname port <span class="token number">80</span> <span class="token number">70</span> <span class="token number">21</span> <span class="token number">0</span>-1024<span class="token punctuation">..</span>. <span class="token comment"># Puerto de destino de la petición</span>
acl aclname proto HTTP FTP <span class="token punctuation">..</span>.      <span class="token comment"># Protocolo de la petición</span>
acl aclname method GET POST <span class="token punctuation">..</span>.     <span class="token comment"># Método de la petición HTTP (GET, POST, HEADER...)</span>
acl aclname browser <span class="token punctuation">[</span>-i<span class="token punctuation">]</span> regexp <span class="token punctuation">..</span>. <span class="token comment"># Comprueba el nombre del navegador cliente</span>
</code></pre><h2 id="25-ejemplos-de-configuración-de-squid">2.5. Ejemplos de configuración de Squid </h2>
<h3 id="ejemplo-1">Ejemplo 1 </h3>
<p>Condiciones a cumplir por la configuración</p>
<ul>
<li>Permitir acceder si "eres el jefe" O (OR) "vas a webs_permitidas"</li>
<li>Si vas a una web que no esté en las permitidas y no eres jefe, se te deniega (última regla).</li>
<li>En cuanto se cumple una, ya se hace el allow</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>http_access allow ip_jefe
http_access allow web_permesa
http_access deny all
</code></pre><blockquote>
<p>¿El jefe podrá acceder a webs no permitidas?</p>
</blockquote>
<h3 id="ejemplo-2-de-uso-de-acls-y-http_access">Ejemplo 2 de uso de acl’s y http_access </h3>
<p>Condiciones a cumplir para el caso</p>
<ul>
<li>Permitir acceder si "eres el jefe" Y (AND) "vas a una web permitida"</li>
<li>Has de ser jefe y ir a web permitida para navegar.</li>
<li>¡Se tienen que cumplir las dos condiciones!</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>http_access allow ip_jefe web_permesa
http_access deny all
</code></pre><blockquote>
<p>¿El jefe podrá acceder a webs no permitidas?</p>
</blockquote>
<h3 id="ejemplo-completo-caso-concreto">Ejemplo completo: caso concreto </h3>
<p>Condiciones a cumplir para el caso</p>
<ul>
<li>Se quiere que el jefe pueda acceder sin restricciones (ninguna) a internet.</li>
<li>Hay unos cuantos sitios web permitidos para cualquier persona y a cualquier hora.</li>
<li>No se permite el acceso a los empleados a webs prohibidas durante el horario de trabajo, pero si en horario de pausa.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>acl pc_jefe src <span class="token number">192.168</span>.0.10
acl palabras_prohibidas url_regex sex porn culo weapon chat
// Palabras excepciones escritas en el fichero con la ruta indicada
acl palabras_excepciones url_regex <span class="token string">"/etc/squid3/acl/palabras_excepciones.acl"</span>  
// Identificador de red <span class="token builtin class-name">local</span>
acl red_local src <span class="token number">192.168</span>.0.10/255.255.255.0     
acl pcs_empleados src <span class="token number">192.168</span>.0.15-192.168.0.20  
// Horario de la pausa
acl horario_pausa <span class="token function">time</span> MTWHF <span class="token number">14</span>:00-15:00
</code></pre><p>Completa el fichero de configuración con las reglas de acceso.</p>
<p>Comprueba si se cumplen las condiciones con la siguiente tabla:</p>
<table>
<thead>
<tr>
<th>Horario de trabajo</th>
<th>Webs permitidas</th>
<th>Webs prohibidas</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jefe</td>
<td>ALLOW</td>
<td>ALLOW</td>
</tr>
<tr>
<td>Empleado</td>
<td>ALLOW</td>
<td>DENY</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Horario de pausa</th>
<th>Webs permitidas</th>
<th>Webs prohibidas</th>
<th>Resto de webs</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jefe</td>
<td>ALLOW</td>
<td>ALLOW</td>
<td>ALLOW</td>
</tr>
<tr>
<td>Empleado</td>
<td>ALLOW</td>
<td>ALLOW</td>
<td>ALLOW</td>
</tr>
</tbody>
</table>
<div class="admonition question">
<p class="admonition-title">Actividades</p>
</div>
<ol>
<li>Puedes indicar qué hacen las siguientes reglas?</li>
</ol>
<ul>
<li>
<p>acl hora time MTWHF 08.00-15.05<br>
http_access deny !hora</p>
</li>
<li>
<p>acl aula src<br>
http_access deny all<br>
http_access allow aula</p>
</li>
<li>
<p>acl webs dstdomain <a href="http://www.google.es">www.google.es</a> <a href="http://www.iesdoctorbalmis.com">www.iesdoctorbalmis.com</a><br>
http_access deny webs</p>
</li>
</ul>
<ol start="2">
<li>Configura un servicio proxy con Squid que proporcione acceso a Internet con la siguiente configuración:</li>
</ol>
<ul>
<li>Hay dos tipos de usuarios, A y B.</li>
<li>Los usuarios de tipo A pueden acceder a todas las direcciones, excepto algunas excepciones.</li>
<li>Los usuarios de tipo B no pueden acceder a ninguna dirección, excepto algunas excepciones.</li>
<li>Utiliza solo el puerto 8080/tcp (en lugar de 3128/tcp que es el que usualmente utiliza).</li>
</ul>
</div>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>